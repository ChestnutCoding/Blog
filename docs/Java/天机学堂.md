# Java项目

# 天机学堂

> 一款基于微服务架构的B2C类型的在线教育项目
> 

## 项目介绍

### 功能架构图

![https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306122139098.png](https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306122139098.png)

### 技术架构

### 后台管理端流程

![https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306122001158.png](https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306122001158.png)

### 学员端流程

![https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306122023740.png](https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306122023740.png)

### 项目开发流程

1. 需求分析
2. 定义数据模型
3. 定义接口
4. 服务端和前端并行开发
5. 前后端集成测试

### 类的领域划分

- DTO：
数据传输对象，在客户端和服务器之前传递数据
微服务间的Feign接口请求参数
前端提交表单传入封装数据
响应给前端的分页封装数据
- PO：
持久层对象，与数据库表一一对应，作为查询数据库时的返回值
- VO：
视图对象，返回给前端用于封装页面展示数据
返回前端
- QO（Query）
查询对象，一般是用于封装复杂查询条件

### gitflow规范

### Git分支规范

- Master：主分支，用于正式发布的分支
- Develop：开发分支，从Master创建得来，功能开发的基础分支
- Feature：功能分支，从Develop唔知创建得来，开发测试完成后会合并到Develop分支
- Release：预发布分支，从Develop分支创建一个Release分支，做一些发布前的准备工作，不可开发功能，最终合并到Master和Develop
- Hotfix：热修复分支，当Master出现经济BUG时，基于Master建立的临时分支，修复完后合并到Develop和Master分支

### Type类别说明

- feat：添加新特性
- fix：修复bug
- docs：仅仅修改了文档
- style：仅仅修改了空格，格式缩进，逗号等等，不改变代码逻辑
- refactor：代码重构，没有增加新功能或修复bug
- pref：增加代码进行性能测试
- test：增加测试用例
- chore：改变构建流程，或者增加依赖库，工具等

### bug解决思路

- 抓包->定位到接口模块->查看log日志

## 我的课表业务

### 业务开发的基本流程

### 项目生命周期

1. 市场调研
2. 业务分析
3. 产品设计
4. 项目开发
5. 测试上线
6. 运维

### 基于项目原型分析课表业务

| 编号 | 接口简述 | 需求说明 |
| --- | --- | --- |
| 1 | 支付或报名课程后，立刻加入课表 | 用户对课程支付成功（收费）/直接添加课程（免费）后，交易服务 会通知 学习服务 来执行加入课表的动作。因此，我们要实现的第一个功能应该是此接口 |
| 2 | 分页查询我的课表 | 分页查询我的课表（已购或已选课程） |
| 3 | 查询我最近正在学习的课程 | 学员每次学习一个最近课程后，在此页面要显示出此课程数据 |
| 4 | 删除课表中的某课程 | ●在课程列表中删除课程</br>●用户退款，应该删除课表中的课程 |
| 5 | 查询课程的学习状态 | 不管是收费还是免费的课程，都要显示出用户对此课程状态内容，根据不同的状态，详情也的按钮也会显示不一致 |
| 6 | 校验指定课程是否是课表中的有效课程（Feign接口） | 其他业务服务需要的学习中心数据内容 |
| 7 | 统计课程学习人数（Feign接口） |  |

### 我的课表数据模型

1. 规范字段：一般数据模型定义（数据表定义），会遵循与开发规范来定义一些固定的数据属性（表字段）
2. 基础字段：根据项目原型来定义数据模型
3. 关联字段：业务的数据模型和其他业务关联内容
4. 冗余字段：便于查询统计，提高查询效率

### 分页查询流程图

![https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306142342241.png](https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306142342241.png)

### ****添加课表数据流程图****

![https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306150003519.png](https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306150003519.png)

上图解释：

1.用户购买课程调用订单微服务

2.订单微服务处理订单和支付相关业务后发送异步消息到MQ

3.学习服务需要查询课程信息，并计算课表的有效时间

4.学习服务监听器接受到添加个人课表数据消息和课程学习计划

### 查询最近课表数据

![https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306150013941.png](https://blog-1312463513.cos.ap-shanghai.myqcloud.com/blog/202306150013941.png)

### 代码分析步骤

1.课表分页条件查询

```
 1.判断关键数据
   前端传入的必要数据--分页数据
 2.构建分页对象
 3.构建查询条件对象
 4.查询结果内容
 5.封装结果并返回
     5.1 获得课表对应的课程数据
     5.2 将课表的数据填充课程内容
```

2.课表添加
	业务层增删改操作：
	  0.是否开启事务
	  1.判断关键数据
	  2.判断业务数据
		关键数据操作的后端数据  或  操作的后端数据所关联的数据

```
   3.业务操作
   4.返回数据
```

3.mp监听器开发流程：
  0.定义交换机、队列、routingKey
  1.接受消息
  2.解析消息并判断消息的合法性
  3.调用业务层完成业务操作

4.删除我的课表

0.是否开启事务
  1.判断关键数据
	前端传递
		UserContext.getUser()
	MQ传递
		必须要传递

2.判断业务数据

```
     课表数据
         1.判断是否存在
         2.判断是否过期
             前端传递--需要判断课程是否过期，如果过期可以删除
                 controller调用service的时候，userid传入null
                         UserContext.getUser()
             MQ传递--不管课表是怎么样的状态，必须删除，不需要判断课表是否过期
                 监听器调用service时候，userid必须传入

     用户数据
         1.判断用户数据是否存在
             UserClient发送feign接口查询用户数据
```

3.业务操作

```
     1.对课表数据进行删除
         需要依据：表结构
                     如果有逻辑字段--逻辑删
                     如果没有--物理删

     2.删除课程对应的学习记录
         此时不删，数据库的垃圾数据
```

4.返回数据-不传递

查api文档

### 学习记录业务

### 学习计划业务